# 数据泄露问题修复说明

## 发现的问题

### 1. 数据预处理问题
- **问题**：数据按`problem_id`排序，而不是按时间排序，导致时间顺序混乱
- **修复**：改为按`time_sec`排序，保持正确的时间顺序

### 2. 数据泄露问题（严重）
- **问题**：模型在预测位置i时，使用了位置i的答案`answer[i]`，这导致数据泄露
- **影响**：这会导致准确率虚高（可能达到0.99），因为模型已经"看到"了答案
- **修复**：修改模型forward函数，使用历史答案（向左shift）：
  - 在位置i，使用`answer[i-1]`（前一个位置的答案）
  - 预测位置i的答案`answer[i]`

## 修复内容

### model.py
- 将答案序列向左shift，第一个位置用0填充
- 这样模型在位置i使用的是历史答案，而不是当前位置的答案

### preprocess_data.py  
- 修改数据排序逻辑，按时间排序而不是按problem_id排序

## 预期效果

修复后，准确率应该会显著下降（从0.99降到正常水平，通常在0.7-0.85之间），这是正常的，因为：
1. 之前的数据泄露导致模型"作弊"
2. 修复后模型只能使用历史信息进行预测

## 建议

1. **重新运行数据预处理**：由于修复了排序问题，建议重新运行`preprocess_data.py`
2. **重新训练模型**：使用修复后的代码重新训练，获得真实的准确率
3. **验证结果**：检查AUC和RMSE指标，确保它们在合理范围内

## 知识追踪任务的标准做法

在知识追踪任务中：
- **输入**：问题序列 `[p0, p1, p2, ..., pn]` 和历史答案序列 `[a0, a1, a2, ..., a(n-1)]`
- **输出**：预测下一个答案 `[pred_a1, pred_a2, ..., pred_an]`
- **真实值**：下一个答案 `[a1, a2, ..., an]`

模型在位置i应该：
- 使用历史信息：`[p0...pi]` 和 `[a0...a(i-1)]`
- 预测当前位置：`pred_ai`
- 与真实值比较：`ai`
